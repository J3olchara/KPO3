# Система обработки заказов и платежей

Микросервисная система для обработки заказов и платежей с использованием асинхронного взаимодействия через Kafka.

## Архитектура системы

Система состоит из следующих компонентов:

1. **API Gateway** (порт 8080)
   - Маршрутизация запросов к соответствующим сервисам
   - Единая точка входа для клиентов

2. **Orders Service** (порт 8081)
   - Создание заказов
   - Просмотр списка заказов
   - Просмотр статуса заказа
   - Реализация паттерна Transactional Outbox для надежной отправки событий

3. **Payments Service** (порт 8082)
   - Создание счета пользователя
   - Пополнение счета
   - Просмотр баланса
   - Обработка платежей с гарантией at-most-once

4. **Kafka** (порт 29092)
   - Обеспечение асинхронного взаимодействия между сервисами
   - Надежная доставка сообщений

5. **PostgreSQL** (порт 5432)
   - Хранение данных о заказах, платежах и счетах

## Запуск системы

### Предварительные требования

- Docker и Docker Compose
- Java 17
- Maven

### Шаги по запуску

1. Сборка проекта:
   ```bash
   mvn clean package -DskipTests
   ```

2. Запуск системы:
   ```bash
   docker-compose up -d
   ```

3. Проверка статуса:
   ```bash
   docker-compose ps
   ```

## API Endpoints

### Orders Service

- `POST /api/orders` - Создание заказа
  - Параметры: userId, amount, description
  
- `GET /api/orders` - Получение списка заказов пользователя
  - Параметры: userId
  
- `GET /api/orders/{orderId}` - Получение информации о конкретном заказе

### Payments Service

- `POST /api/payments/accounts` - Создание счета
  - Параметры: userId
  
- `POST /api/payments/accounts/deposit` - Пополнение счета
  - Параметры: userId, amount
  
- `GET /api/payments/accounts/{userId}` - Получение информации о счете

## Особенности реализации

1. **Надежность доставки сообщений**
   - Использование паттерна Transactional Outbox в Orders Service
   - Гарантия at-most-once при обработке платежей
   - Идемпотентность операций

2. **Согласованность данных**
   - Использование транзакций для атомарных операций
   - Оптимистичная блокировка для счетов
   - Асинхронное обновление статусов заказов

3. **Масштабируемость**
   - Независимые микросервисы
   - Асинхронное взаимодействие через Kafka
   - Возможность горизонтального масштабирования